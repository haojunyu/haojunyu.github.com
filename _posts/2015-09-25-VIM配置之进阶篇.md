---
layout: default
title:  Vim配置之进阶篇
category:   [Ubuntu, Vim]
comments:   true
---
正所谓“工欲善其事，必先利其器”，而作为一个专业的码农，怎么能不好好对待自己编程的利器--VIM编辑器呢！可能读者会说编程的利器不应该是各种语言的集成工具么？像编写C/C++程序的VS，Codeblock（跨平台）软件，像编写Java程序的Eclipse（现在已经有支持C/C++/Python的插件），像编写Python程序的PyCharm等。这些人性化的开发集成环境功能强大，使用方便。不过成也在此，败也在此。本文将详细介绍Vim编辑器以及其基本入门级配置。


## 简介
正所谓“工欲善其事，必先利其器”，而作为一个专业的码农，怎么能不好好对待自己的编程利器--VIM编辑器呢！可能读者会说编程的利器不应该是各种语言的集成工具么？像编写C/C++程序的VS，Codeblock（跨平台）软件，像编写Java程序的Eclipse（现在已经有支持C/C++/Python的插件），像编写Python程序的PyCharm等。这些人性化的开发集成环境功能强大，使用方便。不过我觉得成也在此，败也在此。

1. 功能冗余
现在编程的集成环境工具非常强大，但是很多功能我们都用不到，反而每次开启都花费很长时间。所以集成环境并不适合专业的码农。我们经常说适合自己的才是最好的，编程利器更是如此，毕竟它每天不离手。
2. 定制化太低
基本上每个集成开发工具都没有留太多的定制空间给用户，而用户只能习惯软件供应商提供的大众化用法。对于熟悉多种语言的用户而言，它得掌握多种开发集成环境，还不如用Vim解决所有。
3. 鼠标和键盘的混合使用
其实这一点仁者见仁，智者见智吧。个人觉得高效编程还是需要手不离键盘的，要熟练掌握一些基本的快捷键的使用。


基本的Vim说白了就是一个文本编辑器，不过它的强大之处在于它庞大的插件。这些插件可以让Vim能够干很多牛x的事，这跟google浏览器有点像。像代码补全，错误跳转，高亮显示等等，Vim都有相应的插件来处理，用户可以自行了解，自由组合。所以Vim的入门门坎还是蛮高的，主要是开始学得命令比较多，这里有推荐个[玩游戏记命令的网址][vim_adventures]以及[Vim学习指南][vim_progressively]。此外打造一个适合自己的vim环境将会大大节约时间，是磨刀不误砍柴工的。下面就来看看基础入门级的[Vim插件配置][vim_plugin]。

## 基本配置
1. 安装vim,scripts,doc

    ```sh
    sudo apt-get install vim vim-scripts vim-doc
    ```

    > **Tips:**
    > * vim         vim软件，安装目录是/usr/share/vim
    > * vim-scripts vim的基本插件，包括语法高亮等，安装目录是/usr/share/vim-scripts
    > * vim-doc     vim帮助文件，不过是英文版本的

2. 中文帮助文档
    1. 下载[最新版本](http://sourceforge.net/projects/vimcdoc/files/vimcdoc/)的vim中文帮助文档
    2. 解压doc文件夹到~/.vim目录下

3. 配置~/.vimrc文件
    
    配置个性化的[.vimrc](.vimrc)（不懂的命令可以用`:help command`查看中文帮助文档）


## 实用插件
vim的插件很多，而且功能很强大，非常强大。官网的插件地址在[这里](http://www.vim.org/scripts/script_search_results.php?order_by=creation_date&direction=descending)。

* vundle  
vundle是个用来管理vim插件的插件，它高效的利用了git，使得vim插件的安装，更新和卸载都交由vundle管理，从而将使用者从vim安装配置中解放出来。
	1. 安装vundle
		
		```sh
		git clone https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle
		```
	2. 使用vundle管理vim插件
		1. 在[Vim Script][vim_script]选好想要使用的插件
		2. 在vim配置文件.vimrc中添加`Plugin plugin_name`
		3. 执行Vundle初始化命令`:PluginInstall`，插件就安装好了
		4. 常用命令  
		
		```sh
		# 更新插件
		:PluginInstall!
		# 清除不再使用的插件
		:PluginClean
		# 列出所有插件
		:PluginList
		# 查找插件
		:PluginSearch
		```
	3. vundle在.vimrc中的配置
		
		```vim
		" 文件类型检测关闭[必须]（/usr/share/vim/vim74/filetype.vim）
		filetype off
		" 设置runtime path包含Vundle的路径并且初始化
		set rtp+=~/.vim/bundle/Vundle.vim
		" 设置plugins安装地址
		call vundle#begin('~/.vim/bundle/')
		" 安装Vundle，让其管理插件[必须]
		Plugin 'gmarik/Vundle.vim'

		""""""""""""""""""""""""""""""""""
		" Vundle插件安装样例:
		" 插件在github上
		" Plugin 'tpope/vim-fugitive'
		" 插件来自网页http://vim-scripts.org/vim/scripts.html
		" Plugin 'L9'
		" Git插件，但插件不在Github上
		" Plugin 'git://git.wincent.com/command-t.git'
		" 插件在本地机器上 (i.e. when working on your own plugin)
		" Plugin 'file:///home/gmarik/path/to/plugin'
		" The sparkup vim script is in a subdirectory of this repo called vim.
		" Pass the path to set the runtimepath properly.
		" Plugin 'rstacruz/sparkup', {'rtp': 'vim/'}
		" 使用用户名来避免插件冲突 ie. L9
		" Plugin 'user/L9', {'name': 'newL9'}
		""""""""""""""""""""""""""""""""""

		" 所有插件的添加在end之前[必须]
		call vundle#end()            
		" 文件类型对应的插件[必须]（/usr/share/vim/vim74/ftplugin.vim）
		filetype plugin on
		" 文件类型对应的缩进文件
		filetype indent on
		```
		

* The-NERD-tree  
NERDTree是Vim最常用的插件之一，可以在Vim运行时显示目录和文件结构，类似TextMate左侧的文件浏览器，但操作起来更为方便，你可以在手不离开键盘的情况下快速浏览文件，并在文件和文件夹之间进行切换。其样例如下图所示：
![NERDTree]({{site.baseurl}}/assets/images/the-NERD-tree.gif)
	1. 在vim中的安装和配置
	
		```vim
		call vundle#begin('~/.vim/bundle')
		" 在Vim的编辑窗口中树状显示文件目录[The-NERD-tree]
		Plugin 'The-NERD-tree'
		call vundle#end()  
		
		""""""""""""""""""""""""""""""""""
		" The-NERD-tree配置
		""""""""""""""""""""""""""""""""""
		" 不显示缓冲文件，中间文件
		let NERDTreeIgnore=[ '.pyc$', '.pyo$', '.obj$', '.o$', '.so$', '.egg$', '^.git$', '^.svn$', '^.hg$' ]
		" 只剩一个NERDTree窗口时退出vim
		autocmd bufenter * if (winnr("$") == 1 && exists("b:NERDTreeType") &&b:NERDTreeType == "primary") | q | endif
		" <F9>打开/关闭文件管理器
		nnoremap <silent> <F9> :NERDTreeToggle<CR>
		```
		
* The-NERD-Commenter  
这个插件也是必备的，主要自动注释内容。当你xml自然是xml注释，当你是java自然就是java的注释规则。其样例如下图所示：
![nerdcommenter]({{site.baseurl}}/assets/images/nerdcommenter.gif)
	1. 在vim中的安装和配置
	
		```vim
		call vundle#begin('~/.vim/bundle/')
		" 快速添加/去除注释
		Plugin 'The-NERD-Commenter'
		call vundle#end()  
		
		""""""""""""""""""""""""""""""""""
		" The-NERD-Commenter配置
		""""""""""""""""""""""""""""""""""
		" 注释的时候自动加个空格, 强迫症必配
		let g:NERDSpaceDelims=1
		" mm智能判断加上/解开注释
		map mm <leader>c<space>
		```
		
* ctrlp
这是个文件查找的插件，其功能和NERDTree有点类似，但是还是有点区别吧。其样例如下图所示：
![nerdcommenter]({{site.baseurl}}/assets/images/vim-ctrlp.gif)
	1. 在vim中的安装和配置
	
		```vim
		call vundle#begin('~/.vim/bundle/')
		" 文件搜索
		Plugin 'kien/ctrlp.vim'
		call vundle#end()  
		
		""""""""""""""""""""""""""""""""""
		" ctrlp配置
		""""""""""""""""""""""""""""""""""
		" 设置CtrlP的本地工作目录，0代表不设置该功能
		let g:ctrlp_working_path_mode=0
		" ctrlp窗口在底部
		let g:ctrlp_match_window_bottom=1
		" ctrlp窗口最大高度为15行
		let g:ctrlp_max_height=15
		" 窗口
		let g:ctrlp_match_window_reversed=0
		" 最近打开的文件的个数
		let g:ctrlp_mruf_max=500
		" 记录但去掉重复的软链接
		let g:ctrlp_follow_symlinks=1
		" <Ctrl-f>启动文件查找
		let g:ctrlp_map = '<c-f>'
		" Ctrlp启动文件查找
		let g:ctrlp_cmd = 'CtrlP'
		" 相当于mru功能，show recently opened files
		map <c-p> :CtrlPMRU<CR>
		" 忽略以下文件类型
		set wildignore+=*/tmp/*,*.so,*.swp,*.zip
		" 忽略以下文件目录
		let g:ctrlp_custom_ignore = {'dir':  '/].(git|hg|svn|rvm)$','file': '(exe|so|dll|zip|tar|tar.gz)$'}
		```
		
* ctags  
ctags可以建立源码树的标签索引（标签就是一个标识符被定义的地方，如函数定义），使程序员在编程时能迅速定位函数、变量、宏定义等位置去查看原形。
    1. 安装exuberant-ctags工具
    
        ```sh
        sudo apt-get install exuberant-ctags
        ```
    2. 创建C++代码库索引
        1. 下载[libstdc++](http://www.vim.org/scripts/download_script.php?src_id=9178)头文件,包含c++中STL，streams等。
        2. 解压到~/.vim/tags目录后执行ctags命令
            
            ```sh
            ctags -R --c++-kinds=+p --fields=+iaS --extra=+q --language-force=C++ cpp_src
            mv tags ~/.vim/tags/cpptag
            ```
        3. 在.vimrc中设置
        
            ```vim
            set tags+=~/.vim/tags/cpptag
            ```
    3. 创建gcc代码库索引
        1. ubuntu中安装完build-essential后，会在/usr/include/c++目录下有C/C++的头文件。
            
            ```sh
            sudo apt-get install build-essential
            ```
        2. 拷贝/usr/include/c++/4.8里的文件到~/.vim/tags/gcc文件夹里后执行ctags命令
        
            ```sh
            cp -R /usr/include/c++/4.8 ~/.vim/tags/gcc
            ctags -R --c++-kinds=+p --fields=+iaS --extra=+q gcc
            mv tags ~/.vim/tags/gcctag
            ```
        3. 在.vimrc中设置
            
            ```vim
            set tags+=~/.vim/tags/gcctag
            ```

* tagbar  
tagbar插件是和taglist功能类似的插件，但是它比taglist更优秀，并且能和NERDTree完美配合。
	1. tagbar的优势
		* 支持头文件的函数列表显示  
		细心的读者可能会发现，tagbar对函数的可见级别也是做了区分的，分别用+ – # 并配合着色来做了区分
		* 对面向对象的支持更好  
		taglist虽然也会列出类列表，但是整体还是很不直观
		* 自动根据文件修改时间来重建  
		taglist在这一点上体验就很不好，其实明明可以通过这种时间戳的方式来实现
	2. 在vim中的安装和配置
	
		```vim
		call vundle#begin('~/.vim/bundle/')
		" 替换taglist的插件[tagbar]
		Plugin 'majutsushi/tagbar'
		call vundle#end()  
		
		""""""""""""""""""""""""""""""""""
		" tagbar配置
		""""""""""""""""""""""""""""""""""
		" 启动时自动focus
		let g:tagbar_autofocus=1
		" <F10>打开/关闭Tagbar
		nnoremap <silent> <F10> :TagbarToggle<CR>
		```

* rainbow  
这个插件也是必备的，该插件的主要功能是给配对的(){}[]不同的颜色来区别，非常方便看括号的作用域
	1. 在vim中的安装和配置
	
		```vim
		call vundle#begin('~/.vim/bundle/')
		" 括号显示增强
		Plugin 'luochen1990/rainbow'
		call vundle#end()  
		
		""""""""""""""""""""""""""""""""""
		" rainbow配置
		""""""""""""""""""""""""""""""""""
		" rainbow激活
		let g:rainbow_active = 1
		```
	2. 给rainbow添加自动启动功能
		
		```vim
		if (exists('g:rainbow_active') && g:rainbow_active)
			auto syntax * call rainbow#hook()
			auto colorscheme * call rainbow#show()
			" 下面这命令使rainbow在vim启动时被打开
			autocmd VimEnter * nested call rainbow#toggle()
		endif
		```


* syntastic  
这是一个非常有用的插件，它能够实时的进行语法和编码风格的检查，利用它几乎可以做到编码完成后无编译错误。并且它还集成了静态检查工具：lint，可以让你的代码更加完美。更强大的它支持近百种编程语言，像是一个集大成的实时编译器。出现错误之后，可以非常方便的跳转到出错处。其样例如下图所示：
![nerdcommenter]({{site.baseurl}}/assets/images/vim-syntastic.png)
	1. 在vim中的安装和配置
	
		```vim
		call vundle#begin('~/.vim/bundle/')
		" 语义高亮
		Plugin 'scrooloose/syntastic'
		call vundle#end()  
		
		""""""""""""""""""""""""""""""""""
		" rainbow配置
		""""""""""""""""""""""""""""""""""
		" rainbow激活
		let g:rainbow_active = 1
		```
		



* [YouCompleteMe][youcompleteme]   
YouCompleteMe对代码的补全完全达到了编译器级别，绝不弱于Visual Assist。它是基于LLVM/clang，一个Apple公司为了代替GNU/GCC而支持的编译器，正因为YouCompleteMe有了编译器的支持，而不再像以往的插件一样基于文本来进行匹配，所以准确率才如此之高。而且，它是C/S架构，会在本机创建一个服务器端，利用clang来解析代码，然后将结果返回给客户端，所以也就解决了VIM是单线程而造成的各种补全插件速度奇慢的诟病，在使用时，几乎感觉不到任何的延时，体验达到了Visual Assist的级别。  
YouCompleteMe除了补全以外，还有一个非常重要的作用：代码跳转，同样可以达到编译器级别的准确度，媲美Visual Assist与Source Insight。其样例如下图所示：
![nerdcommenter]({{site.baseurl}}/assets/images/youcompleteme.gif)
	1. 安装必备软件
		
		```sh
		sudo apt-get install clang llvm cmake
		```
	1. 在vim中的安装和配置
	
		```vim
		call vundle#begin('~/.vim/bundle/')
		" 自动补全
		Plugin 'Valloric/YouCompleteMe'
		call vundle#end()  
		
		""""""""""""""""""""""""""""""""""
		" rainbow配置
		""""""""""""""""""""""""""""""""""
		" rainbow激活
		let g:rainbow_active = 1
		```




* winmanager  
WinManager用于管理文件浏览器和缓冲区（buffer）。2.0以上版本的WinManager还可以管理其他IDE类型插件，不过要用户在插件中增加一些辅助变量和hook来支持WinManager（帮助文档有相关说明）。
    1. 安装winmanager
    
        ```sh
        vim-addon-manager install winmanager
        ```
    2. 在.vimrc中配置
    
        ```vim

        ```
    3. 自定义快捷键说明
        * `<F9>`     打开/关闭文件浏览器

* minibufexplorer  
MiniBufferExplorer用于浏览和管理buffer，如果只打开一个文件，是不会显示在屏幕上的，而打开多个文件之后，会自动出现在屏幕上。vim也有自带的buffer管理工具，不过只有:ls, :bnext, :bdelete 等的命令, 既不好用, 又不直观.
    1. 安装minibufexplorer
        
        ```sh
        vim-addon-manager install minibufexplorer
        ```
    2. 在.vimrc中配置
    
        ```vim

        ```
    3. 自定义快捷键说明
        * `<Tab>`     移动到下一个buffer
        * `<C-Tab>`   移动到上一个buffer

* quickfix  
通过quickfix命令集，你可在 Vim 内编译程序并直接跳转到出错位置进行修正。你可以接着重新编译并做修正，直到不再出错为止。因为quickfix已经在vim里集成了，只要配置就好了。
    1. 在.vimrc中配置
    
        ```vim

        ```
    2. 自定义快捷键说明
        * `<F2>`     make当前程序
        * `<F10>`    make clean当前程序
        * `<F3>`     光标移动到上一个错误所在行
        * `<F4>`     光标移动到下一个错误所在行

## 参考文献
1. [有趣的vim游戏][vim_adventures]
2. [Vim学习指南][vim_progressively]
3. [vim plugin][vim_plugin]
3. [Vim Script][vim_script]
4. [Vim配置及说明——IDE编程环境][vim_ide]
5. [高效vim插件][vim_plugin2]
6. [VIM助记图][Vim_Cheat_Sheet]
7. [Vimer的程序世界][vimer]
8. [vimium][vimium]
9. [youcompleteme][youcompleteme]

[vim_adventures]:	http://vim-adventures.com/
[vim_progressively]:	http://www.oschina.net/translate/learn-vim-progressively
[vim_plugin]:		http://my.oschina.net/swuly302/blog/156784
[vim_script]:		http://vim-scripts.org/vim/scripts.html
[vim_ide]:			http://www.it165.net/pro/html/201404/11505.html
[vim_plugin2]:		http://my.oschina.net/swuly302/blog/156784
[Vim_Cheat_Sheet]:	http://overapi.com/vim/
[vimer]:			http://www.vimer.cn/
[vimium]:			https://chrome.google.com/webstore/detail/vimium/dbepggeogbaibhgnhhndojpepiihcmeb
[youcompleteme]:	http://valloric.github.io/YouCompleteMe/
